
```
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Konoha — Main Menu</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./menu.css">
</head>
<body>
  <main class="wrap">
    <section class="panel" role="dialog" aria-labelledby="title">
      <h1 id="title">Konoha — Combat Training</h1>
      <div class="meta" aria-label="version">v0.1 • Single-player prototype</div>
      <div class="grid">
        <nav class="menu" role="menu" aria-label="Main menu">
          <a class="item primary" href="./index.html?play=1" role="menuitem">Start Game</a>
          <button class="item" data-tab="options" role="menuitem">Options</button>
          <button class="item" data-tab="leaderboard" role="menuitem">Leaderboard</button>
          <button class="item" data-tab="changelog" role="menuitem">Changelog</button>
          <button class="item" data-tab="credits" role="menuitem">Credits</button>
        </nav>
      </div>
      <!-- modal -->
      <div id="modal" class="modal hidden" aria-hidden="true">
        <div class="modal-backdrop"></div>
        <section class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
          <header class="modal-head">
            <h2 id="modalTitle"></h2>
            <button id="modalClose" aria-label="Close">✕</button>
          </header>
          <div id="modalBody" class="modal-body"></div>
        </section>
      </div>
      <footer>
        <a class="link" href="./tests/index.html">Run self tests</a>
      </footer>
    </section>
  </main>
  <script>
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalClose = document.getElementById('modalClose');

    const views = {
      options: {
        title: 'Options',
        body: `
          <form id="optsForm">
            <label style="display:flex;align-items:center;gap:10px;margin:8px 0;">
              <input type="checkbox" id="optMuted"> Start Muted
            </label>
            <label style="display:flex;align-items:center;gap:10px;margin:8px 0;">
              <input type="checkbox" id="optDamage" checked> Show Damage Numbers
            </label>
            <p style="margin-top:10px;color:#666;font-size:12px">Settings are saved on this device.</p>
          </form>
        `,
        setup: () => {
          const saved = JSON.parse(localStorage.getItem('konoha.options')||'{}');
          const f = document.getElementById('optsForm');
          const m = f.querySelector('#optMuted'), d = f.querySelector('#optDamage');
          m.checked = !!saved.startMuted; d.checked = saved.showDamageNumbers !== false;
          f.addEventListener('change', ()=>{
            const next = { startMuted: m.checked, showDamageNumbers: d.checked };
            localStorage.setItem('konoha.options', JSON.stringify(next));
          });
        }
      },
      leaderboard: { title: 'Leaderboard', body: `<ol style="margin:8px 0 0 20px">
        <li>Itachi</li><li>Sasuke</li><li>Neji</li><li>Lee</li><li>Tenten</li><li>Naruto</li><li>Kiba</li>
      </ol>` },
      changelog: { title: 'Changelog', body: '<ul><li>v0.1 — Prototype: waves, auto-shuriken, upgrades, main menu</li></ul>' },
      credits: { title: 'Credits', body: '<p>Creator: <a id="creatorLink" class="link" href="#" target="_blank" rel="noopener">Lord Tsarcasm</a></p><p>Design & Code: You + WebSim</p><p>Assets: Minimal vector sprites and procedural audio</p>',
        setup: async () => {
          try {
            const creator = await window.websim.getCreator();
            const a = document.getElementById('creatorLink');
            if (creator?.username && a) a.href = `https://websim.com/@${creator.username}`;
          } catch (e) {}
        } },
    };

    function openModal(key){
      const v = views[key]; if(!v) return;
      modalTitle.textContent = v.title; modalBody.innerHTML = v.body;
      modal.classList.remove('hidden'); modal.setAttribute('aria-hidden','false');
      modalClose.focus();
      v.setup && v.setup();
    }
    function closeModal(){
      modal.classList.add('hidden'); modal.setAttribute('aria-hidden','true');
    }

    document.querySelectorAll('.menu .item[data-tab]').forEach(b=>{
      b.addEventListener('click', ()=>openModal(b.dataset.tab));
    });
    modalClose.addEventListener('click', closeModal);
    modal.querySelector('.modal-backdrop').addEventListener('click', closeModal);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

    // Keyboard: Up/Down to move focus within menu
    const items = Array.from(document.querySelectorAll('.menu .item'));
    document.addEventListener('keydown', (e)=>{
      if(!['ArrowUp','ArrowDown'].includes(e.key)) return;
      e.preventDefault();
      const i = items.indexOf(document.activeElement), n = items.length;
      const j = e.key==='ArrowDown' ? Math.min(n-1, (i<0?0:i+1)) : Math.max(0, (i<=0?0:i-1));
      (items[j]||items[0]).focus();
    });
  </script>
</body>
</html>